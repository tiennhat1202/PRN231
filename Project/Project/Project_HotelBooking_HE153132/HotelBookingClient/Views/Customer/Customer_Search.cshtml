@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<link href="~/css/customercss/customer_hotel_list.css" rel="stylesheet" />

<div id="intro-example" class="p-5 text-center bg-image">
    <div class="d-flex justify-content-center align-items-center h-100">
        <div class="text-white">
            <div class="search-box d-flex align-items-center">
                <partial name="_SearchCustomer">
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="customer-card-list-body">
        <div class="d-flex">
            <a asp-controller="Customer" asp-action="Customer_Home">Trang chủ</a> &nbsp;>&nbsp;
            <a asp-controller="Customer" asp-action="Customer_List"> Danh sách phòng</a> &nbsp;>&nbsp;
            <a asp-controller="Customer" asp-action="Customer_Home"> Kết quả tìm kiếm</a>
        </div>

        <div class="row ms-0 me-0">
            <!-- BlockFilter Start -->
            <div class="col-sm-3 filter mt-3">
                <div class="filter-box">
                    <div class="text-center title-filter">Lọc phòng</div>
                    <div class="mt-2 mb-2 ps-2 pe-2 box-filter-price">
                        <label for="vol" class="title-filter-price">Giá phòng: 0 - 10.000.000VND</label><br>
                        <input id="vol" type="range" value="500000" min="1" max="10000000" oninput="this.nextElementSibling.value = this.value">
                        <output class="result-filter-price">500000</output><span class="vnd">VND</span>
                    </div>
                    <div class="mt-2 mb-2 ps-2 pe-2 box-filter-type">
                    </div>
                    <div class="mt-2 mb-2 ps-2 pe-2 box-filter-hotel">
                    </div>
                </div>


            </div>
            <!-- Block Filter End -->
            <!-- BlockItem -->
            <div class="col-sm-9" id="item">
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {

        loadDataSearch();
        loadDataNavSearch();

        function loadDataNavSearch() {
            var roomTypeResult, hotelStateResult;
            var roomTypePromise = $.ajax({
                url: "https://localhost:7152/api/RoomType",
                type: "get",
                contentType: "application/json; charset=utf-8",
                dataType: "json"
            }).done(function (result) {
                roomTypeResult = result;
            }).fail(function (xhr, status, error) {
                console.log(xhr);
            });

            var hotelPromise = $.ajax({
                url: "https://localhost:7152/api/Hotel",
                type: "get",
                contentType: "application/json; charset=utf-8",
                dataType: "json"
            }).done(function (result) {
                hotelStateResult = result;
            }).fail(function (xhr, status, error) {
                console.log(xhr);
            });

            $.when(roomTypePromise, hotelPromise).done(function () {

                //Handler CheckboxState
                var uniqueStates = [];
                for (var i = 0; i < hotelStateResult.length; i++) {
                    var hotelState = hotelStateResult[i];
                    if (!uniqueStates.includes(hotelState.state)) {
                        uniqueStates.push(hotelState.state);
                    }
                }
                var container = document.querySelector('.box-filter-hotel');
                var title = document.createElement('label');
                title.classList.add('title-filter-state', 'mb-2');
                title.textContent = 'Địa điểm';
                container.appendChild(title);
                container.appendChild(document.createElement('br'));

                for (var i = 0; i < uniqueStates.length; i++) {
                    var state = uniqueStates[i];
                    // Tạo phần tử input
                    var input = document.createElement('input');
                    input.type = 'checkbox';
                    input.id = state.toLowerCase();
                    input.name = state.toLowerCase();
                    input.value = state;
                    input.setAttribute('style', 'margin-right: 5px;');

                    // Tạo phần tử label
                    var label = document.createElement('label');
                    label.htmlFor = state.toLowerCase();
                    label.textContent = ' ' + state;

                    // Thêm input và label vào container
                    container.appendChild(input);
                    container.appendChild(label);
                    container.appendChild(document.createElement('br'));
                }

                //Handler CheckboxRoomType
                var container = document.querySelector('.box-filter-type');
                var title = document.createElement('label');
                title.classList.add('title-filter-type', 'mb-2');
                title.textContent = 'Loại phòng';
                container.appendChild(title);
                container.appendChild(document.createElement('br'));

                for (var i = 0; i < roomTypeResult.length; i++) {
                    var roomType = roomTypeResult[i];
                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = roomType.roomTypeName.toLowerCase();
                    checkbox.name = roomType.roomTypeName.toLowerCase();
                    checkbox.value = roomType.roomTypeId;
                    checkbox.setAttribute('style', 'margin-right: 5px;');

                    var label = document.createElement('label');
                    label.setAttribute('for', roomType.roomTypeName.toLowerCase());
                    label.textContent = roomType.roomTypeName;

                    container.appendChild(checkbox);
                    container.appendChild(label);
                    container.appendChild(document.createElement('br'));
                }
            });
        }

        function loadDataSearch(){
            var searchData = localStorage.getItem('searchData');
            if (searchData) {
                searchDataP = JSON.parse(searchData);
                if (searchDataP.length != 0){
                    $("#item").html("");
                    for (var i = 0; i < searchDataP.length; i++) {
                        var room = searchDataP[i];
                        var imageUrl = room.roomImages.length > 0 ? room.roomImages[0].imageUrl : "";
                        var formattedPrice = room.pricePerNight.toLocaleString();
                        var cardHtml = `
                                        <div class="row mt-3 mb-3">
                                            <div class="col-sm-12">
                                                <div class="card w-100 card-item">
                                                    <div class="row ms-2">
                                                        <div hidden value="${room.roomId}"></div>
                                                        <div class="col-sm-3 card-img-item d-flex align-items-center justify-content-center">
                                                                <img src="${imageUrl}" alt="" />
                                                        </div>
                                                        <div class="col-sm-9 card-body">
                                                            <h5 class="card-title">${room.roomName}</h5>
                                                            <div class="card-text">
                                                                <div class="item-location">
                                                                    <i class="fa-solid fa-location-dot dot-hotel"></i> Địa chỉ: ${room.address}
                                                                </div>
                                                                <div class="item-roomtype mt-2 mb-2">
                                                                    Loại phòng: ${room.roomTypeName}
                                                                </div>
                                                                <div class="item-roomdescription mb-2">
                                                                    Mô tả: ${room.description}
                                                                </div>
                                                            </div>
                                                            <div class="mt-3 d-flex align-items-center justify-content-between">
                                                                    <span class="price">Giá phòng: ${formattedPrice} VND</span>
                                                                    <button class="btn-booking" data-room-id="${room.roomId}">Đặt phòng</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>`;
                        $("#item").append(cardHtml);
                    }
                }else{
                    $("#item").html("");
                    var cardHtml = `<div class="d-flex align-items-center justify-content-center mt-3">Không có kết quả tìm kiếm</div>`
                    $("#item").append(cardHtml);
                }
                

                document.querySelectorAll('.btn-booking').forEach(function (button) {
                    button.addEventListener('click', function () {
                        var roomId = this.getAttribute('data-room-id');
                        // console.log("roomId: " + roomId);
                        // Chuyển trang với roomId được truyền qua URL
                        window.location.href = '/Customer/Customer_Room_Detail?roomId=' + roomId;
                    });
                });
            } else {
                console.log('No search data found in localStorage.');
            }
           
        }
    
    })
    
</script>
 
                       